"0","get_score_diff = function(g,t){
"
"2","There were 34 warnings (use warnings() to see them)"
"2","
"
"0","  (("
"0","    cumsum(g$IsTouchdown & g$OffenseTeam == t & !(g$IsInterception | g$IsFumble))*6 + "
"0","    cumsum(g$IsExp & g$OffenseTeam == t) + "
"0","    cumsum(g$IsTwoPointConversionSuccessful & g$OffenseTeam == t)*2 + #Own Team Gets 2pt cnv"
"0","    cumsum(g$IsFieldGoal & g$OffenseTeam == t)*3 +"
"0","      cumsum(grepl(""SAFETY"", g$Description) & g$DefenseTeam == t)*2 + #Own Team forces safety"
"0","      cumsum(g$IsTouchdown & (g$IsInterception | g$IsFumble) & g$DefenseTeam == t) #Own Team Defense Scores"
"0","  )"
"0","  -"
"0","  ("
"0","    cumsum(g$IsTouchdown & g$DefenseTeam == t & !(g$IsInterception | g$IsFumble))*6 + "
"0","    cumsum(g$IsExp & g$DefenseTeam == t) +"
"0","    cumsum(g$IsTwoPointConversionSuccessful & g$DefenseTeam == t)*2 + #Own Team Gets 2pt cnv"
"0","    cumsum(g$IsFieldGoal & g$DefenseTeam == t)*3 +"
"0","    cumsum(grepl(""SAFETY"", g$Description) & g$OffenseTeam == t)*2   +  #Own Team forces safety"
"0","    cumsum(g$IsTouchdown & (g$IsInterception | g$IsFumble) & g$OffenseTeam == t) #Own Team Defense Scores"
"0","  )) "
"0","}"
"0",""
"0","teams = hash()"
"0",""
"0","for (t in team_names) {"
"0","  teams[[t]] = hash()"
"0","  #Get dataset for each team"
"0","  team_df = subset(data_2021, (OffenseTeam == t | DefenseTeam == t))"
"0","  #For Each team put games and plays in chronological order"
"0","  team_df = team_df[with(team_df, order(GameId, Quarter, desc(Minute), desc(Second), Down)), ]"
"0","  #Split team into games"
"0","  i = 1"
"0","  for (g in unique(team_df$GameId)){"
"0","    week = sprintf(""Week %s"", i)"
"0","    teams[[t]][[week]] = subset(team_df, GameId == g)"
"0","    teams[[t]][[week]]$IsFieldGoal = apply(teams[[t]][[week]], 1, FUN = function(x) (x[""PlayType""]==""FIELD GOAL"" & !(grepl(""NO GOOD"", x[""Description""]))))"
"0","    teams[[t]][[week]]$IsExp = apply(teams[[t]][[week]], 1, FUN = function(x) (x[""PlayType""]==""EXTRA POINT"" & !(grepl(""NO GOOD"", x[""Description""]))))"
"0","    teams[[t]][[week]]$ScoreDiff = get_score_diff(teams[[t]][[week]], t)"
"0","    i = i + 1"
"0","  }"
"0","}"
